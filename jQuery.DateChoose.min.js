function DateChoose(o){$(event.target).DateChoose(o)}!function(o,e,t){o.fn.DateChoose=function(e){function s(e,t,s,n){e.$ChooseDtbody.find("td").off("click"),e.$ChooseDtbody.empty(),e.currMonthDate=new Date(t+"-"+s+"-1"),e.currMonthDateOne=new Date(t,s,0),e.currMonthLength=e.currMonthDateOne.getDate();for(var r=1,h=0;6>h;h++)for(var i=o("<tr></tr>").appendTo(e.$ChooseDtbody),u=0;7>u;u++)if(0==h)u>=e.currMonthDate.getDay()?(r=r>=1&&9>=r?"0"+r:r,r==n?o('<td class="active">'+r+"</td>").appendTo(i):o("<td>"+r+"</td>").appendTo(i),r++):o("<td></td>").appendTo(i);else{var $=r>e.currMonthLength?"":r;$=$>=1&&9>=$?"0"+$:$,$==n?o('<td class="active">'+r+"</td>").appendTo(i):o("<td>"+$+"</td>").appendTo(i),r++}e.$ChooseDtbody.find("td").on("click",function(){return""==o(this).text()?!1:(e.$ChooseDtbody.find("td").removeClass("active"),o(this).addClass("active"),a.val(e.$monthCurr.text()+"-"+o(this).text()),void e.$box.hide())})}function n(e,s,n,r,h,a,i,u){console.log(e,s,n,r,h,a,i,u),e.preventDefault();var $=0;o(t).bind("mousemove",function(e){e.preventDefault(),$=e.pageX-s.offset().left-n.width()/2,$=0>=$?0:$,$=$>h?h:$,$-=n.width()/2,o(i).css("left",$),m[u]=parseInt(($+n.width()/2)/a)<=9?"0"+parseInt(($+n.width()/2)/a):parseInt(($+n.width()/2)/a),r.text(m[u]+":"),r.text(0==u?m[u]+":":m[u])})}event.stopPropagation();var r={type:"YY-MM",$error:o(".ChooseBox-error"),$box:o(".ChooseBox"),$yearbox:o(".Choose-year"),$yearPrev:o(".Choose-year-prev"),$yearNext:o(".Choose-year-next"),$yearCurr:o(".Choose-year-curr"),$monthbox:o(".Choose-month"),$ChooseDbox:o(".Choose-day-box"),$ChooseDbar:o(".Choose-day-bar"),$monthPrev:o(".Choose-month-prev"),$monthCurr:o(".Choose-month-curr"),$monthNext:o(".Choose-month-next"),$ChooseDtablebox:o(".Choose-day-table"),$ChooseDtable:o(".Choose-day-table>table"),$ChooseDtbody:o(".Choose-day-table>table>tbody"),$ChooseYDbox:o(".Choose-yearmonth-box"),$Choosehmbox:o(".ChooseTimeBox"),$currTimebox:o(".Choose-time"),$hoursbox:o(".Choose-hours"),$minutesbox:o(".Choose-minutes"),$btnbox:o(".ChooseTimeBox-btn-box"),$hoursPoint:o(".Choose-hours-point"),$hoursLine:o(".Choose-hours-line"),$hoursCurr:o(".Choose-curr-hours"),$minutesPoint:o(".Choose-minutes-point"),$minutesLine:o(".Choose-minutes-line"),$minutesCurr:o(".Choose-curr-minutes"),$btn:o(".ChooseTimeBox-btn"),$currbtn:o(".ChooseTimeBox-curr-btn")},h=o.extend(r,e),a=o(this),i=a.val(),u=a.offset().left,$=a.offset().top+a.height(),c=new Date,d=c.getFullYear(),l=c.getMonth()+1,p=c.getDate(),C=c.getHours(),b=c.getMinutes(),m=[];switch(C=C>=0&&9>=C?"0"+C:C,b=b>=0&&9>=b?"0"+b:b,l=l>=1&&9>=l?"0"+l:l,p=p>=1&&9>=p?"0"+p:p,h.type){case"YY-MM-DD":h.reg=/^\d{4}(\-|\/|\.)\d{1,2}\1\d{1,2}$/,h.reg.test(a.val())&&(m=i?m.concat(i.split("-")):m),m.length<=0?m.push(d,l,p):m,d=m[0],l=m[1],p=m[2];break;case"hh-mm":h.reg=/^([01]\d|2[01234]):([0-5]\d|60)$/,h.reg.test(a.val())&&(m=i?m.concat(i.split(":")):m),m.length<=0?m.push(C,b):m,C=m[0],b=m[1];break;case"YY-MM":default:h.reg=/^\d{4}-(0[1-9]|1[0-2])$/,h.reg.test(a.val())&&(m=i?m.concat(i.split("-")):m),m.length<=0?m.push(d,l):m,d=m[0],l=m[1]}if(h.currday=d+"-"+l+"-"+p,h.currtime=C+":"+b,h.currMonth=d+"-"+l,0==h.$box.length){h.$box=o('<div class="ChooseBox"></div>').css({left:u,top:$}).appendTo(o("body")),h.$error=o('<span class="ChooseBox-error">格式错误</span>').appendTo(h.$box),h.$ChooseDbox=o('<div class="Choose-day-box"></div>').appendTo(h.$box),h.$ChooseDbar=o('<div class="Choose-day-bar"></div>').appendTo(h.$ChooseDbox),h.$monthPrev=o('<span class="Choose-month-prev"><</span>').appendTo(h.$ChooseDbar),h.$monthCurr=o('<span class="Choose-month-curr">'+h.currMonth+"</span>").appendTo(h.$ChooseDbar),h.$monthNext=o('<span class="Choose-month-next">></span>').appendTo(h.$ChooseDbar),h.$ChooseDtablebox=o('<div class="Choose-day-table"></div>').appendTo(h.$ChooseDbox),h.$ChooseDtable=o("<table><thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead></table>").appendTo(h.$ChooseDtablebox),h.$ChooseDtbody=o("<tbody></tbody>").appendTo(h.$ChooseDtable),s(h,d,l,p),h.$ChooseYDbox=o('<div class="Choose-yearmonth-box"></div>').appendTo(h.$box),h.$yearbox=o('<div class="Choose-year"></div>').appendTo(h.$ChooseYDbox),h.$yearPrev=o('<span class="Choose-year-prev"><</span>').appendTo(h.$yearbox),h.$yearCurr=o('<span class="Choose-year-curr">'+m[0]+"</span>").appendTo(h.$yearbox),h.$yearNext=o('<span class="Choose-year-next">></span>').appendTo(h.$yearbox),h.$monthbox=o('<ul class="Choose-month"></ul>').appendTo(h.$ChooseYDbox);for(var x=1;12>=x;x++){var v=x;v=9>=x?"0"+x:x,o('<li data-month="'+x+'">'+v+"</li>").appendTo(h.$monthbox)}h.$monthbox.children().eq(parseInt(l)-1).addClass("active"),h.$Choosehmbox=o('<div class="ChooseTimeBox"></div>').appendTo(h.$box),h.$currTimebox=o('<div class="Choose-time"><span class="ChooseTimeBox-name">时间：</span></div>').appendTo(h.$Choosehmbox),h.$hoursCurr=o('<span class="Choose-curr-hours">'+h.currtime.split(":")[0]+":</span>").appendTo(h.$currTimebox),h.$minutesCurr=o('<span class="Choose-curr-minutes">'+h.currtime.split(":")[1]+"</span>").appendTo(h.$currTimebox),h.$hoursbox=o('<div class="Choose-hours"><span class="ChooseTimeBox-name">时：</span></div>').appendTo(h.$Choosehmbox),h.$minutesbox=o('<div class="Choose-minutes"><span class="ChooseTimeBox-name">分：</span></div>').appendTo(h.$Choosehmbox),h.$btnbox=o('<div class="ChooseTimeBox-btn-box"></div>').appendTo(h.$Choosehmbox),h.$hoursLine=o('<span class="Choose-hours-line"></span>').appendTo(h.$hoursbox),h.$minutesLine=o('<span class="Choose-minutes-line"></span>').appendTo(h.$minutesbox),h.$hoursPoint=o('<span class="Choose-hours-point"></span>').appendTo(h.$hoursLine),h.$minutesPoint=o('<span class="Choose-minutes-point"></span>').appendTo(h.$minutesLine),h.$currbtn=o('<button  class="ChooseTimeBox-curr-btn">当前时间</button>').appendTo(h.$btnbox),h.$btn=o('<button class="ChooseTimeBox-btn">确定</button>').appendTo(h.$btnbox),h.$box.on("click",function(o){o.stopPropagation()}),h.$yearPrev.on("click",function(){h.$yearCurr.text(parseInt(h.$yearCurr.text())-1)}),h.$yearNext.on("click",function(){h.$yearCurr.text(parseInt(h.$yearCurr.text())+1)}),h.hoursLinelength=h.$hoursLine.width(),h.hoursLinelengthAvr=h.hoursLinelength/23,h.minutesLinelength=h.$minutesLine.width(),h.minutesLinelengthAvr=h.minutesLinelength/59,h.$hoursPoint.on("mousedown",function(o){n(o,h.$hoursLine,h.$hoursPoint,h.$hoursCurr,h.hoursLinelength,h.hoursLinelengthAvr,this,0)}),h.$minutesPoint.on("mousedown",function(o){n(o,h.$minutesLine,h.$minutesPoint,h.$minutesCurr,h.minutesLinelength,h.minutesLinelengthAvr,this,1)}),o(t).on("mouseup",function(){o(t).unbind("mousemove")}),h.$currbtn.on("click",function(){m[0]=(new Date).getHours()>=0&&(new Date).getHours()<=9?"0"+(new Date).getHours():(new Date).getHours(),m[1]=(new Date).getMinutes()>=0&&(new Date).getMinutes()<=9?"0"+(new Date).getMinutes():(new Date).getMinutes(),h.$hoursPoint.css("left",h.hoursLinelengthAvr*parseInt(m[0])-h.$hoursPoint.width()/2),h.$minutesPoint.css("left",h.minutesLinelengthAvr*parseInt(m[1])-h.$minutesPoint.width()/2),h.$hoursCurr.text(m[0]+":"),h.$minutesCurr.text(m[1])})}else{switch(h.$box.show().css({left:u,top:$}),h.type){case"hh-mm":h.$hoursCurr.text(m[0]+":"),h.$minutesCurr.text(m[1]),h.hoursLinelength=h.$hoursLine.width(),h.hoursLinelengthAvr=h.hoursLinelength/23,h.minutesLinelength=h.$minutesLine.width(),h.minutesLinelengthAvr=h.minutesLinelength/59,h.$box.show().css({left:u,top:$}),h.$btn.off("click");break;case"YY-MM-DD":h.$monthPrev.off("click"),h.$monthNext.off("click"),h.$monthCurr.off("click"),h.$monthCurr.text(h.currMonth),s(h,d,l,p);case"YY-MM":h.$monthbox.children().removeClass("active").eq(parseInt(m[1])-1).addClass("active"),h.$monthbox.children().off("click"),h.$yearCurr.text(m[0])}o(t).off("click")}switch(h.type){case"YY-MM-DD":h.$ChooseDbox.show(),h.$ChooseYDbox.hide(),h.$Choosehmbox.hide(),h.$monthbox.children().on("click",function(){h.$monthbox.children().removeClass("active"),o(this).addClass("active"),d=h.$yearCurr.text(),l=o(this).text(),h.$ChooseYDbox.hide(),h.$ChooseDbox.show(),h.$monthCurr.text(d+"-"+l),s(h,d,l)}),h.$monthPrev.on("click",function(){var o=h.$monthCurr.text().split("-");o[1]=parseInt(o[1])-1,parseInt(o[1])<1&&(o[0]=parseInt(o[0])-1,o[1]=12),o[1]=o[1]>=1&&o[1]<=9?"0"+o[1]:o[1],h.$monthCurr.text(o[0]+"-"+o[1]),s(h,o[0],o[1],p)}),h.$monthNext.on("click",function(){var o=h.$monthCurr.text().split("-");o[1]=parseInt(o[1])+1,parseInt(o[1])>12&&(o[0]=parseInt(o[0])+1,o[1]=1),o[1]=o[1]>=1&&o[1]<=9?"0"+o[1]:o[1],h.$monthCurr.text(o[0]+"-"+o[1]),s(h,o[0],o[1],p)}),h.$monthCurr.on("click",function(){var o=h.$monthCurr.text().split("-");l=o[1],d=o[0],h.$yearCurr.text(d),h.$monthbox.children().removeClass("active").eq(parseInt(l)-1).addClass("active"),h.$ChooseDbox.hide(),h.$ChooseYDbox.show()});break;case"hh-mm":h.$ChooseDbox.hide(),h.$ChooseYDbox.hide(),h.$Choosehmbox.show(),h.$hoursPoint.css("left",h.hoursLinelengthAvr*parseInt(m[0])-h.$hoursPoint.width()/2),h.$minutesPoint.css("left",h.minutesLinelengthAvr*parseInt(m[1])-h.$minutesPoint.width()/2),h.$btn.on("click",function(){o(this).addClass("active"),a.val(h.$hoursCurr.text()+h.$minutesCurr.text()),h.$box.hide()});break;case"YY-MM":default:h.$ChooseDbox.hide(),h.$ChooseYDbox.show(),h.$Choosehmbox.hide(),h.$monthbox.children().on("click",function(){h.$monthbox.children().removeClass("active"),o(this).addClass("active"),a.val(h.$yearCurr.text()+"-"+h.$monthbox.children(".active").text()),h.$box.hide()})}return o(t).on("click",function(){""==a.val()||h.reg.test(a.val())?(clearTimeout(this.timer),h.$box.hide()):(h.$error.show(),this.timer=setTimeout(function(){h.$error.hide()},500))}),console.log(h),h}}(jQuery,window,document);